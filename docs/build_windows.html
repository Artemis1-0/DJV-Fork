---
layout: page
title: Building on Microsoft Windows
---

<div class="block">
	<p class="header">Building on Microsoft Windows</p>
    <p class="list"><a class="text" href="#Prerequisites">Prerequisites</a></p>
    <p class="list"><a class="text" href="#Preparation">Preparation</a></p>
    <p class="list"><a class="text" href="#BuildingFFmpeg">Building FFmpeg</a></p>
    <p class="list"><a class="text" href="#SuperBuild">Super Build</a></p>
</div>

<div class="block">
	<p class="header"><a name="Prerequisites">Prerequisites</a></p>
	<p>Check that you have the following prerequisites:</p>
	<ul>
	    <li><a class="text" href="https://www.microsoft.com/en-us/windows/get-windows-10">Windows 10</a></li>
		<li><a class="text" href="http://www.opengl.org">OpenGL</a> (version 4.1 or later)</li>
		<li><a class="text" href="https://visualstudio.microsoft.com">Visual Studio</a> (version 2017 or later)</li>
		<li><a class="text" href="https://cmake.org">CMake</a> (version 3.18 or later)</li>
		<li><a class="text" href="https://git-scm.com">git</a></li>
		<li><a class="text" href="https://www.nasm.us">NASM</a></li>
	</ul>
</div>

<div class="block">
	<p class="header"><a name="Preparation">Preparation</a></p>
    <p>Choose a directory to work in, this is where the code will be
    checked out and built. This directory will be referred to as DJV_BUILD
    in the rest of the documentation.</p>
	<p>Open a Visual Studio x64 command prompt, go to the build directory,
	and clone the DJV repository:</p>
	<pre>
> git clone https://github.com/darbyjohnston/DJV.git
</pre>
	<p>Setup environment variables:</p>
	<pre>
[Debug]

> set DJV_BUILD=%CD%
> set PATH=%DJV_BUILD%\DJV-install-Debug\bin;%PATH%
</pre>
	<pre>
[Release]

> set DJV_BUILD=%CD%
> set PATH=%DJV_BUILD%\DJV-install-Release\bin;%PATH%
</pre>
</div>

<div class="block">
	<p class="header"><a name="FFmpeg">Building FFmpeg</a></p>
	<p>The following steps describe how to use the Windows Subsystem for
	Linux to cross-compile FFmpeg for Windows.</p>
	<p>Enable the Windows Subsystem for Linux:</p>
	<ul>
		<li>Open the Windows control panel and click on "Programs and Features"</li>
		<li>Click on "Turn Windows features on or off" on the left side of the "Programs and Features" window</li>
		<li>Check the "Windows Subsystem for Linux" item in the "Windows Features" window</li>
		<li>Restart your computer</li>
		<li>Install Ubuntu from the Windows app store</li>
	</ul>
	<p>Start an Ubuntu shell and setup the environment:</p>
	<pre>
$ sudo apt update
$ sudo apt install mingw-w64 yasm make unzip
</pre>
	<p>Build FFmpeg:</p>
	<pre>
$ wget https://ffmpeg.org/releases/ffmpeg-4.2.2.tar.bz2
$ tar xvf ffmpeg-4.2.2.tar.bz2
$ cd ffmpeg-4.2.2
$ ./configure \
      --disable-programs \
      --disable-doc \
      --disable-bzlib \
      --disable-iconv \
      --disable-lzma \
      --disable-vaapi \
      --enable-pic \
      --arch=x86_64 \
      --cross-prefix=x86_64-w64-mingw32- \
      --target-os=mingw32 \
      --enable-cross-compile \
      --prefix=DJV_BUILD \
      --enable-shared
$ make
$ make install
</pre>
    <p>Currently there is a bug where the .lib files are installed in the "DJV_BUILD/bin"
    directory instead of the "DJV_BUILD/lib" directory. To fix this use the Windows File
    Explorer to manually move the files "avcodec.lib", "avdevice.lib", "avfilter.lib",
    "avformat.lib", "avutil.lib", "swresample.lib", and "swscale.lib" from
    "DJV_BUILD/bin" to "DJV_BUILD/lib".</p>
</div>

<div class="block">
	<p class="header"><a name="SuperBuild">Super Build</a></p>
	<p>This builds both DJV and the neccessary third party dependencies.</p>
	<p>Create a directory for the build and run CMake:</p>
	<pre>
[Debug]

> mkdir DJV-Debug
> cd DJV-Debug
> cmake ..\DJV\etc\SuperBuild -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=%DJV_BUILD%/DJV-install-Debug -DCMAKE_PREFIX_PATH=%DJV_BUILD%/DJV-install-Debug
</pre>
	<pre>
[Release]

> mkdir DJV-Release
> cd DJV-Release
> cmake ..\DJV\etc\SuperBuild -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=%DJV_BUILD%/DJV-install-Release -DCMAKE_PREFIX_PATH=%DJV_BUILD%/DJV-install-Release
</pre>
<p>Start the build:</p>
	<pre>
[Debug]

> cmake --build . --config Debug -j
</pre>
	<pre>
[Release]

> cmake --build . --config Release -j
</pre>
    <p>Note that if you are using Visual Studio solutions and get the error:</p>
    <pre>
LINK : fatal error LNK1104: cannot open file 'djv.ilk' [djv..vcxproj]
</pre>
    <p>Run the build command a second time and the error should go away.</p>
	<p>Try running the DJV player application:</p>
	<pre>
[Debug]

> DJV\src\DJV-build\build\bin\Debug\djv
</pre>
	<pre>
[Release]

> DJV\src\DJV-build\build\bin\Release\djv
</pre>
    <p>When developing DJV with a super build you can speed up build times
    by skipping the third party dependencies. Note that you must have
    built the thirty party dependencies first:</p>
    <pre>
[Debug]

> cd DJV\src\DJV-build
> cmake --build . --config Debug -j
</pre>
    <pre>
[Release]

> cd DJV\src\DJV-build
> cmake --build . --config Release -j
</pre>
    <p>Note that this also works when using Visual Studio solutions;
    just open the Visual Studio solution in the folder shown above.</p>
</div>

