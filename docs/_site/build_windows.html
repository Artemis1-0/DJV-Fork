<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="assets/style.css">
    <title>Building on Microsoft Windows</title>
  </head>
  <body>
    <div class="logo">
        <img src="assets/djv_logo.svg">
    </div>
    <div class="nav">
    <p><a class="text" href="index.html">Home</a> |
    <a class="text" href="documentation.html">Documentation</a> |
    Building on Microsoft Windows</p>
</div>

<div class="block">
	<p class="header">Building on Microsoft Windows</p>

	<p class="subHeader"><a name="Requirements">Requirements</a></p>
	<ul>
	    <li><a class="text" href="https://www.microsoft.com/en-us/windows/get-windows-10">Windows 10</a></li>
		<li><a class="text" href="https://visualstudio.microsoft.com">Visual Studio</a> (version 2017 or later)</li>
		<li><a class="text" href="https://cmake.org">CMake</a> (version 3.12 or later)</li>
		<li><a class="text" href="https://git-scm.com">git</a></li>
	</ul>

	<p class="subHeader"><a name="Preparation">Preparation</a></p>
    <p>First choose a directory to work in, this is where the code will be
    checked out and built. This directory will be referred to as $DJV_BUILD
    in the rest of the documentation.</p>
	<p>Append this to your PATH environment variable in the Windows control
	panel:</p>
	<pre>
$DJV_BUILD/DJV-install-Debug/bin
</pre>

	<p class="subHeader"><a name="FFmpeg">Building FFmpeg</a></p>
	<p>The following steps describe how to use the Windows Subsystem for
	Linux to cross-compile FFmpeg for Windows.</p>
	<p>Enable the Windows Subsystem for Linux:</p>
	<ul>
		<li>Open the Windows control panel and click on "Programs and Features"</li>
		<li>Click on "Turn Windows features on or off" on the left side of the "Programs and Features" window</li>
		<li>Check the "Windows Subsystem for Linux" item in the "Windows Features" window</li>
		<li>Restart your computer</li>
		<li>Install Ubuntu from the Windows app store</li>
	</ul>
	<p>Start an Ubuntu shell and setup the environment:</p>
	<pre>
$ sudo apt update
$ sudo apt install mingw-w64 yasm make unzip
</pre>
	<p>Build FFmpeg:</p>
	<pre>
$ wget https://ffmpeg.org/releases/ffmpeg-4.2.2.tar.bz2
$ tar xvf ffmpeg-4.2.2.tar.bz2
$ cd ffmpeg-4.2.2
$ ./configure \
      --disable-programs \
      --disable-doc \
      --disable-bzlib \
      --disable-iconv \
      --disable-lzma \
      --enable-pic \
      --arch=x86_64 \
      --cross-prefix=x86_64-w64-mingw32- \
      --target-os=mingw32 \
      --enable-cross-compile \
      --prefix=$DJV_BUILD \
      --enable-shared
$ make
$ make install
</pre>

	<p class="subHeader"><a name="BuildingDJV">Building DJV</a></p>
	<p>Open a Visual Studio x64 command prompt, go to the build directory,
	and clone the DJV repository:</p>
	<pre>
> cd $BUILD_DIR
> git clone https://github.com/darbyjohnston/DJV.git
</pre>
	<p>Create a new directory for the build and run CMake:</p>
	<pre>
> mkdir djv-Debug
> cd djv-Debug
> cmake ..\DJV -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=$BUILD_DIR/DJV-install-Debug
</pre>
	<p>Open "DJV.sln" in Visual Studio and build the solution.</p>
	<p>Try runing the confidence tests to make sure eveything works
	by building the RUN_TESTS target.</p>

	<p class="subHeader"><a name="Packaging">Packaging DJV</a></p>
	<p>Create a new directory for a release build and run CMake:</p>
	<pre>
> mkdir djv-Release
> cd djv-Release
> cmake ..\DJV -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$BUILD_DIR/DJV-install-Release
</pre>
	<p>Open "DJV.sln" in Visual Studio and build the solution.</p>
	<p>Create the packages by building the PACKAGE target.</p>
</div>




    <div class="footer">
        <p class="legal">
            Copyright (c) 2004-2020 Darby Johnston -
            <a class="text" href="legal.html">Legal</a>
        </p>
    </div>
  </body>
</html>

