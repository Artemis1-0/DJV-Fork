<!-- ---------------------------------------------------------------------------
  Copyright (c) 2004-2015 Darby Johnston
  All rights reserved.
  
  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above copyright notice,
    this list of conditions, and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions, and the following disclaimer in the documentation
    and/or other materials provided with the distribution.
  
  * Neither the names of the copyright holders nor the names of any
    contributors may be used to endorse or promote products derived from this
    software without specific prior written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  SUBSTITUE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  POSSIBILITY OF SUCH DAMAGE.
---------------------------------------------------------------------------- -->

<html>

<head>

<link rel="stylesheet" type="text/css" href="djvStyle.css">
<title>DJV Imaging - Source Code</title>
</head>

<body>

<div class="header">
<div style="position:absolute; top:10; left:10; height:50;">
<a href="index.html"><img src="images/djvTitle.gif" align="middle"></a>
</div>
<div style="position:absolute; top:0; right:0;">
<a href="index.html"><img src="images/djvLogo.gif"></a>
</div>
</div>

<div class="nav">
<a class="nav" href="index.html">Home</a>
<a class="nav" href="djvScreenshots.html">Screenshots</a>
<a class="nav" href="djvHelp.html">Help</a>
<a class="nav" href="djvCredits.html">Credits</a>
<a class="nav" href="djvLegal.html">Legal</a>
<a class="nav" href="http://sourceforge.net/projects/djv/">Sourceforge</a>
</div>

<div class="content">
<table width="90%" align="center">
<tr>
<td>

<h1>Source Code</h1>
<p>The DJV source code is available for download and may be used to compile
your own version or to make modifications. The source code is provided under
a BSD-style open source <a href="djvLegal.html">license</a>. DJV also depends
on a number of third party software packages which are covered by their own
license terms, see the documentation of the individual packages for details.</p>
<ul>
    <li><a href="#ThirdPartySoftware">Third Party Software</a></li>
    <ul>
        <li><a href="#ThirdPartySoftwareLinux">Linux</a></li>
        <li><a href="#ThirdPartySoftwareOSX">OS X</a></li>
        <li><a href="#ThirdPartySoftwareWindows">Windows</a></li>
    </ul>
    <li><a href="#DJV">DJV</a></li>
    <ul>
        <li><a href="#DJVLinux">Linux</a></li>
        <li><a href="#DJVOSX">OS X</a></li>
        <li><a href="#DJVWindows">Windows</a></li>
    </ul>
</ul>

<a name="ThirdPartySoftware"><h2>Third Party Software</h2></a>
<p>DJV depends on a number of third party software packages that need to be
built before the DJV source code can be built. Some of these packages are
required, like Qt, while others are optional, like FFmpeg.</p>

<table>
	<th colspan=2>Required</th>
    <tr>
        <td><a href="http://glew.sourceforge.net/">GLEW</a></td>
        <td>OpenGL extension wrangling</td>
    </tr>
    <tr>
        <td><a href="http://www.openexr.com/">IlmBase</a></td>
        <td>16-bit half-float type</td>
    </tr>
    <tr>
        <td><a href="http://www.qt.io/">Qt</a></td>
        <td>User interface toolkit and system utilities</td>
    </tr>
</table>
<table>
	<th colspan=2>Optional</th>
    <tr>
        <td><a href="http://www.zlib.net/">zlib</a></td>
        <td>Compression library used by libtiff and OpenEXR</td>
    </tr>
    <tr>
        <td><a href="http://www.ijg.org/">libjpeg</a></td>
        <td>JPEG image I/O plugin</td>
    </tr>
    <tr>
        <td><a href="http://www.libpng.org/">libpng</a></td>
        <td>PNG image I/O plugin</td>
    </tr>
    <tr>
        <td><a href="http://www.libtiff.org/">libtiff</a></td>
        <td>TIFF image I/O plugin</td>
    </tr>
    <tr>
        <td><a href="http://www.openexr.com/">OpenEXR</a></td>
        <td>OpenEXR image I/O plugin</td>
    </tr>
    <tr>
        <td><a href="http://www.ffmpeg.org/">FFmpeg</a></td>
        <td>FFmpeg image I/O plugin</td>
    </tr>
</table>

<a name="ThirdPartySoftwareLinux"><h3>Linux</h3></a>
<p>The following instructions describe how to build the third party software
packages on Linux systems.</p>
<p>First clone the repository:</p>
<pre>
> git clone git://git.code.sf.net/p/djv/git-third-party djv-git-third-party
</pre>
<p>Then run the build script:</p>
<pre>
> cd djv-git-third-party
> sh Linux-64.sh
</pre>

<a name="ThirdPartySoftwareOSX"><h3>OS X</h3></a>
<p>The following instructions describe how to build the third party software
packages on Apple OS X systems.</p>
<p>First clone the repository:</p>
<pre>
> git clone git://git.code.sf.net/p/djv/git-third-party djv-git-third-party
</pre>
<p>Then run the build script:</p>
<pre>
> cd djv-git-third-party
> sh OSX-64.sh
</pre>

<a name="ThirdPartySoftwareWindows"><h3>Windows</h3></a>
<p>The following instructions describe how to build the third party software
packages on Microsoft Windows systems.</p>
<p>First clone the repository:</p>
<pre>
mingw> git clone git://git.code.sf.net/p/djv/git-third-party djv-git-third-party
</pre>
<p>Then uncompress the third party packages:</p>
<pre>
mingw> tar zxvf ffmpeg-2.6.2.tar.gz
mingw> tar zxvf glew-1.10.0.tgz
mingw> tar zxvf ilmbase-2.2.0.tar.gz
mingw> tar xzvf jpegsrc.v9.tar.gz
mingw> tar zxvf libpng-1.6.8.tar.gz
mingw> tar zxvf openexr-2.2.0.tar.gz
mingw> tar zxvf tiff-4.0.3.tar.gz
mingw> tar zxvf yasm-1.3.0.tar.gz
mingw> tar zxvf zlib-1.2.8.tar.gz
mingw> unzip qt-everywhere-opensource-src-5.3.2.zip
mingw> mv qt-everywhere-opensource-src-5.3.2 qt
</pre>
<p>Note that the Qt directory is renamed to avoid problems with long path names.</p>
<p>Apply the patch for OpenEXR (note this is using the MinGW patch command,
though the patch is simple enough you could also apply it by hand):</p>
<pre>
mingw> patch
      openexr-2.2.0/IlmImf/ImfCompressionAttribute.h
      patch/openexr.ImfCompressionAttribute.h.patch
</pre>
<p>Create a new directory for the CMake build (I ususally make this a sibling
of the Git directory):</p>
<pre>
> mkdir djv-git-third-party-Windows-64-cmake
> cd djv-git-third-party-Windows-64-cmake
</pre>
<p>Run CMake giving it the path to the Git directory:</p>
<pre>
> cmake -G "NMake Makefiles" ..\djv-git-third-party
</pre>
<p>Then run NMake to build the third party packages:</p>
<pre>
> nmake
> nmake package
</pre>
<p>This will produce a file called "djv-git-third-party-Windows-64.zip" that
contains all of the third party files (except for Qt) that are needed to
build DJV. Choose a directory and unzip this file (I usually make this a
sibling of the Git and CMake directories).</p>
<p>To build Yasm create a new directory for the CMake build (I ususally make
this a sibling of the Git directory):</p>
<pre>
> mkdir yasm-Windows-64-cmake
> cd yasm-Windows-64-cmake
</pre>
<p>Run CMake giving it the path to the Yasm directory and the installation
path:</p>
<pre>
> cmake
	-G "NMake Makefiles"
	-DCMAKE_INSTALL_PREFIX=C:\...\djv-git-third-party-Windows-64
	..\djv-git-third-party\yasm-1.3.0
</pre>
<p>Then run NMake to build and install Yasm:</p>
<pre>
> nmake
> nmake install
</pre>
<p>To build FFmpeg first append the path with the installation path:</p>
<pre>
mingw> export PATH=$PATH:/c/.../djv-git-third-party-Windows-64/bin
</pre>
<p>Then enter the FFmpeg source directory and run the configure script,
setting the installation path:</p>
<pre>
mingw> ./configure 
</pre>
<p>To build Qt enter the Qt source directory and run the configure script,
setting the installation path:</p>
<p>\todo Is there anything else that can be disabled for a minimal Qt build?</p>
<pre>
> configure
      -prefix C:\...\djv-git-third-party-Windows-64
      -opengl desktop
      -opensource
      -confirm-license
      -nomake examples
      -skip qtconnectivity
      -skip qtdeclarative
      -skip qtlocation
      -skip qtmultimedia
      -skip qtscript
      -skip qtsensors
      -skip qtserialport
      -skip qtwebkit
      -skip qtwebkit-examples
      -skip qtwebsockets
      -skip qtwinextras
      -skip qtxmlpatterns
> nmake
> nmake install
</pre>
<p>Finally set some environment variables so that DJV can find the third party
packages (note that the CMake variables needs '/' instead of '\' for the
path delimeters):</p>
<pre>
> set CMAKE_PREFIX_PATH=C:/.../djv-git-third-party-Windows-64
> set PATH=%PATH%;C:\...\djv-git-third-party-Windows-64\bin
</pre>
<p>For convenience these variables may be set permanently through the Windows
Control Panel or added to a batch script. See the files in the DJV source
directory under "etc\Windows" for an example.</p>

<a name="DJV"><h2>DJV</h2></a>
<p>The CMake modules used for locating the third party software are located in
the directory "cmake/Modules".</p>

<a name="DJVLinux"><h3>Linux</h3></a>
<p>The following instructions describe how to build DJV on Linux systems.</p>
<p>First clone the repository:</p>
<pre>
> git clone git://git.code.sf.net/p/djv/git djv-git
</pre>
<p>Then create a directory for the CMake build:</p>
<pre>
> mkdir djv-git-Linux-64
> cd djv-git-Linux-64
</pre>
<p>If you built the third party software packages from source then set the
CMAKE_PREFIX_PATH environment variable and append the path:</p>
<pre>
> export CMAKE_PREFIX_PATH=/.../djv-git-third-party-Linux-64
> export PATH=$PATH:/.../djv-git-third-party-Linux-64/bin
</pre>
<p>Run CMake and then start the build:</p>
<pre>
> cmake ../djv-git
> make
> make test
> make package
</pre>

<a name="DJVOSX"><h3>OS X</h3></a>
<p>The following instructions describe how to build DJV on Apple OS X
systems.</p>
<p>First clone the repository:</p>
<pre>
> git clone git://git.code.sf.net/p/djv/git djv-git
</pre>
<p>Then create a directory for the CMake build:</p>
<pre>
> mkdir djv-git-OSX-64
> cd djv-git-OSX-64
</pre>
<p>If you built the third party software packages from source then set the
CMAKE_PREFIX_PATH environment variable and append the path:</p>
<pre>
> export CMAKE_PREFIX_PATH=/.../djv-git-third-party-OSX-64
> export PATH=$PATH:/.../djv-git-third-party-OSX-64/bin
</pre>
<p>Run CMake and then start the build:</p>
<pre>
> cmake ../djv-git
> make
> make test
> make package
</pre>

<a name="DJVWindows"><h3>Windows</h3></a>
<p>The following instructions describe how to build DJV on Microsoft
Windows systems.</p>
<p>First clone the repository:</p>
<pre>
> git clone git://git.code.sf.net/p/djv/git djv-git
</pre>
<p>Then create a directory for the CMake build:</p>
<pre>
> mkdir djv-git-Windows-64
> cd djv-git-Windows-64
</pre>
<p>If you built the third party software packages from source then set the
CMAKE_PREFIX_PATH environment variable and append the path:</p>
<pre>
> set CMAKE_PREFIX_PATH=C:\...\djv-git-third-party-OSX-64
> set PATH=%PATH%;C:\...\djv-git-third-party-OSX-64\bin
</pre>
<p>Run CMake and then start the build:</p>
<pre>
> cmake -G "NMake Makefiles" ..\djv-git
> nmake
> nmake test
> nmake package
</pre>

</td>
</tr>
</table>
</div>

<div class="footer">
Copyright (c) 2004-2015 Darby Johnston
</div>

</body>

</html>
